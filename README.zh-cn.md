# shoot        [English](https://github.com/lopolopen/shoot/blob/main/README.md)
为 "go generate" 而打造的工具集。

# 项目状态:
BETA版本，谨慎使用！

# 如何使用?

```zsh
Usage: shoot <subcommand> [options]
These are all the sub commands supported as of now:
new [-opt] [-getset] [-json] [-exp] [-tagcase=<case>] [-type=<Type> | -file=<GoFile>] [dir] [-s] [-v]
enum [-bit] [-json] [-text] -[sql] [-type=<Type> | -file=<GoFile>] [dir] [-v]
rest [-type=<Type> | -file=<GoFile>] [dir] [-v]
map [-path=<path>] [-alias=<alias>] [-to=<DestType>] [-type=<SrcType> | -file=<GoFile>] [dir] [-s] [-v]
```

## 使用 go1.24+ （推荐）

### 为什么是1.24
[工具依赖文档](https://golang.google.cn/doc/modules/managing-dependencies#tools)

### 安装
```zsh
go get -tool github.com/lopolopen/shoot/cmd/shoot@latest
```

### 生成指令示例：
```go
//go:generate go tool shoot new -getset -json -type=YourType

//go:generate go tool shoot new -getset -json -file=$GOFILE

//go:generate go tool shoot enum -json -type=YourEnum

//go:generate go tool shoot rest -type=YourClient

//go:generate go tool shoot map -path=../destpath -type=YourSrcType
```

```zsh
go generate 		# 在当前目录执行
go generate ./...	# 递归当前目录及其子目录
```

## 使用 go1.24- （至少1.18）

```zsh
go install github.com/lopolopen/shoot/cmd/shoot@latest

go get github.com/lopolopen/shoot@latest	# 低版本的项目中需要单独安装
```

```go
//go:generate shoot new -getset -json -type=YourType

//go:generate shoot new -getset -json -file=$GOFILE

//go:generate shoot enum -json -type=YourEnum

//go:generate shoot rest -type=YourClient

//go:generate shoot map -path=../destpath -type=YourSrcType
```

## 生成文件示例1：
```go
// Code generated by "shoot new -getset -type=User"; DO NOT EDIT.

package example

// NewUser constructs a new instance of type User
func NewUser(id int, name string, age int) *User {
	return &User{
		id:   id,
		name: name,
		age:  age,
	}
}

// Id gets the value of field id
func (u *User) Id() int {
	return u.id
}

// Name gets the value of field name
func (u *User) Name() string {
	return u.name
}

// Age gets the value of field age
func (u *User) Age() int {
	return u.age
}

// SetId sets the value of field id
func (u *User) SetId(id_ int) {
	u.id = id_
}

// SetName sets the value of field name
func (u *User) SetName(name_ string) {
	u.name = name_
}

// SetAge sets the value of field age
func (u *User) SetAge(age_ int) {
	u.age = age_
}
```

## 生成文件示例2:
```go
// Code generated by "shoot rest -type=Client"; DO NOT EDIT.

package example

import (
	"context"
	"encoding/json"
	"fmt"
	"io"
	"net/http"
	"net/url"
	"strings"
	"time"

	"github.com/lopolopen/shoot"
)

type client struct {
	client *http.Client
	conf   *shoot.RestConf
}

func (c *client) GetUser(ctx context.Context, userID string, pageSize int, pageIdx *int) (*User, *http.Response, error) {
	path_ := "/users/{id}"
	path_ = strings.Replace(path_, "{id}", fmt.Sprintf("%v", userID), 1)

	url_, err := url.JoinPath(c.conf.BaseURL(), path_)
	if err != nil {
		return nil, nil, err
	}

	req_, err := http.NewRequestWithContext(ctx, "GET", url_, nil)
	if err != nil {
		return nil, nil, err
	}

	query_ := req_.URL.Query()
	query_.Set("size", fmt.Sprintf("%v", pageSize))
	if pageIdx != nil {
		query_.Set("page_idx", fmt.Sprintf("%v", *pageIdx))
	}
	req_.URL.RawQuery = query_.Encode()

	req_.Header.Add("Accept", "application/json")
	req_.Header.Add("Tenant-Id", "123")

	resp_, err := c.client.Do(req_)
	if err != nil {
		return nil, nil, err
	}
	defer resp_.Body.Close()

	switch {
	case resp_.StatusCode >= 500:
		body_, _ := io.ReadAll(resp_.Body)
		err = fmt.Errorf("server error %d: %s", resp_.StatusCode, string(body_))
	case resp_.StatusCode >= 400:
		body_, _ := io.ReadAll(resp_.Body)
		err = fmt.Errorf("client error %d: %s", resp_.StatusCode, string(body_))
	case resp_.StatusCode >= 300 || resp_.StatusCode < 200:
		err = fmt.Errorf("not supported error %d", resp_.StatusCode)
	}
	if err != nil {
		return nil, resp_, err
	}

	var r_ User
	err = json.NewDecoder(resp_.Body).Decode(&r_)
	if err == io.EOF {
		err = nil //ignore EOF errors caused by empty response body
	}
	if err != nil {
		return nil, resp_, err
	}
	return &r_, resp_, nil
}
```

## generated file sample 3:
```go
// Code generated by "shoot map -path=../../domain/model -alias=domain -type=*"; DO NOT EDIT.

package dto

import domain "mappersample/domain/model"

// ToDomain converts receiver to type domain.Order
func (o *Order) ToDomain() *domain.Order {
	if o == nil {
		return nil
	}
	order_ := new(domain.Order)
	order_.ID = o.ID
	order_.Amount = o.StringToDecimal(o.Amount)
	order_.Status = o.Status
	order_.OrderTime = o.StringToTime(o.OrderingTime)
	if o.Address != nil {
		order_.Address = *o.Address.ToDomain()
	}
	o.writeDomain(order_)
	return order_
}

// FromDomain reads from type domain.Order, then writes back to receiver and returns it
func (o *Order) FromDomain(order_ *domain.Order) *Order {
	if order_ == nil {
		return o
	}
	if o == nil {
		o = new(Order)
	}
	o.ID = order_.ID
	o.Amount = o.DecimalToString(order_.Amount)
	o.Status = order_.Status
	o.OrderingTime = o.TimeToString(order_.OrderTime)
	o.Address = new(OrderAddress).FromDomain(&order_.Address)
	o.readDomain(order_)
	return o
}
```

## 更多示例：
[示例](https://github.com/lopolopen/shoot/tree/main/samples)

# 启发项目：
* [stringer](https://pkg.go.dev/golang.org/x/tools/cmd/stringer)
* [enumer](https://github.com/dmarkham/enumer)
* [genapi](https://github.com/lexcao/genapi)
* [Refit](https://github.com/reactiveui/refit)
